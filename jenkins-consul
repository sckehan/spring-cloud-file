pipeline {
   agent {label 'linux-205'}
   stages {
      
      stage('Pull Code') {
         steps {
            git 'https://github.com/sckehan/spring-cloud-examples.git'
            sh 'ls'
         }

      }
     
      stage('Build Code') {
         steps {
            sh 'mvn -v'
            sh 'cd spring-cloud-consul/spring-cloud-consul-producer && mvn clean package'
         }

      }

         stage('Build Image') {
            steps {
               //sh 'cd spring-cloud-consul/spring-cloud-consul-producer'
               sh 'docker -v'
               sh 'cd spring-cloud-consul/spring-cloud-consul-producer && docker build -t="docker.io/sckehan/spring-cloud-consul-producer:latest" .'
               sh 'docker run -it -d --name spring-cloud-consul-producer -p 8501:8501 docker.io/sckehan/spring-cloud-consul-producer:latest'
            }

         }
   }
}
